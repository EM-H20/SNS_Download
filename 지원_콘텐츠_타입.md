# ì§€ì›ë˜ëŠ” Instagram ì½˜í…ì¸  íƒ€ì…

## âœ… ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥í•œ ì½˜í…ì¸ 

### 1. Reels (ë¦´ìŠ¤) ğŸ¬
```
URL: https://www.instagram.com/reel/{shortcode}/
íƒ€ì…: ë¹„ë””ì˜¤ (MP4)
ë‹¤ìš´ë¡œë“œ: ë¹„ë””ì˜¤ + ì¸ë„¤ì¼
```

**ì˜ˆì‹œ:**
```bash
POST /api/download
{
  "url": "https://www.instagram.com/reel/ABC123/"
}

# ì‘ë‹µ
{
  "status": "success",
  "media_url": "/downloads/ABC123/2024-11-04_ABC123.mp4",
  "media_type": "video",
  "thumbnail_url": "/downloads/ABC123/2024-11-04_ABC123.jpg",
  "metadata": {
    "duration_seconds": 15,
    "width": 1080,
    "height": 1920
  }
}
```

### 2. ì¼ë°˜ ë¹„ë””ì˜¤ í¬ìŠ¤íŠ¸ ğŸ¥
```
URL: https://www.instagram.com/p/{shortcode}/
íƒ€ì…: ë¹„ë””ì˜¤ (MP4)
ë‹¤ìš´ë¡œë“œ: ë¹„ë””ì˜¤ + ì¸ë„¤ì¼
```

**ì˜ˆì‹œ:**
```bash
POST /api/download
{
  "url": "https://www.instagram.com/p/DEF456/"
}

# ì‘ë‹µ
{
  "status": "success",
  "media_url": "/downloads/DEF456/2024-11-04_DEF456.mp4",
  "media_type": "video",
  "thumbnail_url": "/downloads/DEF456/2024-11-04_DEF456.jpg",
  "metadata": {
    "duration_seconds": 30,
    "width": 1920,
    "height": 1080
  }
}
```

### 3. ì‚¬ì§„ í¬ìŠ¤íŠ¸ ğŸ“·
```
URL: https://www.instagram.com/p/{shortcode}/
íƒ€ì…: ì‚¬ì§„ (JPG)
ë‹¤ìš´ë¡œë“œ: ì‚¬ì§„ (ì¸ë„¤ì¼ ì—†ìŒ)
```

**ì˜ˆì‹œ:**
```bash
POST /api/download
{
  "url": "https://www.instagram.com/p/GHI789/"
}

# ì‘ë‹µ
{
  "status": "success",
  "media_url": "/downloads/GHI789/2024-11-04_GHI789.jpg",
  "media_type": "photo",
  "thumbnail_url": null,  # ì‚¬ì§„ì€ ì¸ë„¤ì¼ì´ ì—†ìŒ
  "metadata": {
    "duration_seconds": null,  # ì‚¬ì§„ì€ duration ì—†ìŒ
    "width": 1080,
    "height": 1080
  }
}
```

## ğŸ“Š ì½˜í…ì¸  íƒ€ì…ë³„ íŠ¹ì§•

| ì½˜í…ì¸  íƒ€ì… | íŒŒì¼ í˜•ì‹ | ì¸ë„¤ì¼ | Duration | íŒŒì¼ í¬ê¸° |
|------------|----------|--------|----------|----------|
| Reels | MP4 | âœ… JPG | âœ… | 2-20 MB |
| ë¹„ë””ì˜¤ í¬ìŠ¤íŠ¸ | MP4 | âœ… JPG | âœ… | 5-50 MB |
| ì‚¬ì§„ í¬ìŠ¤íŠ¸ | JPG | âŒ | âŒ | 500 KB - 5 MB |

## ğŸ”„ Downloads í´ë” êµ¬ì¡°

### Reels / ë¹„ë””ì˜¤
```
downloads/
â””â”€â”€ ABC123/
    â”œâ”€â”€ 2024-11-04_ABC123.mp4    # ë¹„ë””ì˜¤ íŒŒì¼
    â””â”€â”€ 2024-11-04_ABC123.jpg    # ì¸ë„¤ì¼
```

### ì‚¬ì§„
```
downloads/
â””â”€â”€ GHI789/
    â””â”€â”€ 2024-11-04_GHI789.jpg    # ì‚¬ì§„ íŒŒì¼ (ì¸ë„¤ì¼ ì—†ìŒ)
```

## ğŸ¯ Media Type êµ¬ë¶„

ì„œë²„ëŠ” ìë™ìœ¼ë¡œ ì½˜í…ì¸  íƒ€ì…ì„ ê°ì§€í•©ë‹ˆë‹¤:

```python
# downloader.pyì—ì„œ ìë™ ê°ì§€
if post.is_video:
    media_type = "video"
    # MP4 íŒŒì¼ + JPG ì¸ë„¤ì¼ ë‹¤ìš´ë¡œë“œ
else:
    media_type = "photo"
    # JPG íŒŒì¼ë§Œ ë‹¤ìš´ë¡œë“œ (ì¸ë„¤ì¼ ì—†ìŒ)
```

## ğŸ“ API ì‘ë‹µ ì°¨ì´ì 

### ë¹„ë””ì˜¤ ì‘ë‹µ
```json
{
  "status": "success",
  "media_url": "/downloads/ABC123/2024-11-04_ABC123.mp4",
  "media_type": "video",
  "thumbnail_url": "/downloads/ABC123/2024-11-04_ABC123.jpg",  // âœ… ìˆìŒ
  "metadata": {
    "duration_seconds": 15,  // âœ… ìˆìŒ
    "width": 1080,
    "height": 1920
  }
}
```

### ì‚¬ì§„ ì‘ë‹µ
```json
{
  "status": "success",
  "media_url": "/downloads/GHI789/2024-11-04_GHI789.jpg",
  "media_type": "photo",
  "thumbnail_url": null,  // âŒ null
  "metadata": {
    "duration_seconds": null,  // âŒ null
    "width": 1080,
    "height": 1080
  }
}
```

## ğŸš« ì§€ì›í•˜ì§€ ì•ŠëŠ” ì½˜í…ì¸ 

### 1. ìºëŸ¬ì…€ (ì—¬ëŸ¬ ì¥ ì‚¬ì§„/ë¹„ë””ì˜¤)
```
í˜„ì¬ ìƒíƒœ: ì²« ë²ˆì§¸ ë¯¸ë””ì–´ë§Œ ë‹¤ìš´ë¡œë“œ
í–¥í›„ ê°œì„ : ëª¨ë“  ë¯¸ë””ì–´ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥í•˜ë„ë¡ ê°œì„  ì˜ˆì •
```

### 2. ìŠ¤í† ë¦¬ (Stories)
```
í˜„ì¬ ìƒíƒœ: ì§€ì› ì•ˆ í•¨
ì´ìœ : ìŠ¤í† ë¦¬ëŠ” 24ì‹œê°„ í›„ ì‚­ì œë˜ê³ , URL êµ¬ì¡°ê°€ ë‹¤ë¦„
```

### 3. ë¼ì´ë¸Œ ë°©ì†¡
```
í˜„ì¬ ìƒíƒœ: ì§€ì› ì•ˆ í•¨
ì´ìœ : ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°ì€ ë‹¤ìš´ë¡œë“œ ë¶ˆê°€
```

### 4. IGTV (ë ˆê±°ì‹œ)
```
URL: https://www.instagram.com/tv/{shortcode}/
í˜„ì¬ ìƒíƒœ: âœ… ì§€ì›ë¨ (ë¹„ë””ì˜¤ í¬ìŠ¤íŠ¸ì™€ ë™ì¼)
```

## ğŸ’¡ ì‚¬ìš© ì˜ˆì‹œ

### Pythonìœ¼ë¡œ ë‹¤ì–‘í•œ íƒ€ì… ë‹¤ìš´ë¡œë“œ
```python
import requests

def download_instagram_media(url):
    # 1. ë‹¤ìš´ë¡œë“œ ìš”ì²­
    response = requests.post(
        "http://localhost:8000/api/download",
        json={"url": url}
    )
    data = response.json()

    # 2. íƒ€ì… í™•ì¸
    media_type = data['media_type']
    print(f"Media type: {media_type}")

    # 3. íŒŒì¼ ë‹¤ìš´ë¡œë“œ
    media_url = f"http://localhost:8000{data['media_url']}"

    if media_type == "video":
        # ë¹„ë””ì˜¤ + ì¸ë„¤ì¼ ë‹¤ìš´ë¡œë“œ
        video = requests.get(media_url).content
        with open("video.mp4", "wb") as f:
            f.write(video)

        if data['thumbnail_url']:
            thumb_url = f"http://localhost:8000{data['thumbnail_url']}"
            thumb = requests.get(thumb_url).content
            with open("thumbnail.jpg", "wb") as f:
                f.write(thumb)

    elif media_type == "photo":
        # ì‚¬ì§„ë§Œ ë‹¤ìš´ë¡œë“œ
        photo = requests.get(media_url).content
        with open("photo.jpg", "wb") as f:
            f.write(photo)

# ì‚¬ìš©
download_instagram_media("https://instagram.com/reel/ABC123/")  # ë¹„ë””ì˜¤
download_instagram_media("https://instagram.com/p/GHI789/")     # ì‚¬ì§„
```

### JavaScriptë¡œ íƒ€ì…ë³„ ì²˜ë¦¬
```javascript
async function downloadMedia(url) {
  // 1. ë‹¤ìš´ë¡œë“œ ìš”ì²­
  const response = await fetch('http://localhost:8000/api/download', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({url})
  });

  const data = await response.json();

  // 2. íƒ€ì…ë³„ ì²˜ë¦¬
  if (data.media_type === 'video') {
    console.log('ë¹„ë””ì˜¤ ë‹¤ìš´ë¡œë“œ');
    downloadFile(data.media_url, 'video.mp4');
    if (data.thumbnail_url) {
      downloadFile(data.thumbnail_url, 'thumbnail.jpg');
    }
  } else if (data.media_type === 'photo') {
    console.log('ì‚¬ì§„ ë‹¤ìš´ë¡œë“œ');
    downloadFile(data.media_url, 'photo.jpg');
  }
}

function downloadFile(url, filename) {
  const a = document.createElement('a');
  a.href = `http://localhost:8000${url}`;
  a.download = filename;
  a.click();
}
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: Reels ë‹¤ìš´ë¡œë“œ
```bash
curl -X POST "http://localhost:8000/api/download" \
  -H "Content-Type: application/json" \
  -d '{"url": "https://www.instagram.com/reel/ABC123/"}'

# í™•ì¸
ls downloads/ABC123/
# 2024-11-04_ABC123.mp4
# 2024-11-04_ABC123.jpg
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì‚¬ì§„ ë‹¤ìš´ë¡œë“œ
```bash
curl -X POST "http://localhost:8000/api/download" \
  -H "Content-Type: application/json" \
  -d '{"url": "https://www.instagram.com/p/GHI789/"}'

# í™•ì¸
ls downloads/GHI789/
# 2024-11-04_GHI789.jpg (ì¸ë„¤ì¼ ì—†ìŒ)
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: íƒ€ì… ìë™ ê°ì§€ í™•ì¸
```bash
# API ë¬¸ì„œì—ì„œ í…ŒìŠ¤íŠ¸
# http://localhost:8000/docs

# 1. Reels URL ì…ë ¥
# 2. ì‘ë‹µì—ì„œ media_type: "video" í™•ì¸
# 3. thumbnail_urlì´ ìˆëŠ”ì§€ í™•ì¸

# 1. ì‚¬ì§„ URL ì…ë ¥
# 2. ì‘ë‹µì—ì„œ media_type: "photo" í™•ì¸
# 3. thumbnail_urlì´ nullì¸ì§€ í™•ì¸
```

## âš™ï¸ ì½”ë“œ êµ¬í˜„ ì„¸ë¶€ì‚¬í•­

### 1. Instaloader ì„¤ì • (app/downloader.py)
```python
self.loader = instaloader.Instaloader(
    download_videos=True,           # âœ… ë¹„ë””ì˜¤ ë‹¤ìš´ë¡œë“œ
    download_video_thumbnails=True, # âœ… ë¹„ë””ì˜¤ ì¸ë„¤ì¼
    download_pictures=True,         # âœ… ì‚¬ì§„ ë‹¤ìš´ë¡œë“œ
)
```

### 2. íƒ€ì… ê°ì§€ ë¡œì§
```python
# Instagram APIì—ì„œ íƒ€ì… í™•ì¸
if post.is_video:
    media_type = "video"
    media_path = self._find_video_file(target_dir, shortcode)
    thumbnail_path = self._find_thumbnail_file(target_dir, shortcode)
else:
    media_type = "photo"
    media_path = self._find_image_file(target_dir, shortcode)
    thumbnail_path = None  # ì‚¬ì§„ì€ ì¸ë„¤ì¼ ì—†ìŒ
```

### 3. íŒŒì¼ í™•ì¥ìë¡œ íƒ€ì… ê²°ì •
```python
# main.pyì—ì„œ ìµœì¢… í™•ì¸
media_type = "video" if media_path.suffix.lower() == ".mp4" else "photo"
```

## ğŸ“š ì¶”ê°€ ì°¸ê³  ì‚¬í•­

### í™”ì§ˆ ì˜µì…˜
- í˜„ì¬: ì›ë³¸ í™”ì§ˆë§Œ ë‹¤ìš´ë¡œë“œ
- í–¥í›„: `quality` íŒŒë¼ë¯¸í„° êµ¬í˜„ ì˜ˆì • (high/medium/low)

### íŒŒì¼ í¬ê¸° ì œí•œ
- í˜„ì¬: `.env`ì—ì„œ `MAX_FILE_SIZE_MB=100` ì„¤ì •
- ê¸°ë³¸ê°’: 100MB
- ëŒ€ë¶€ë¶„ì˜ Instagram ì½˜í…ì¸ ëŠ” 50MB ì´í•˜

### ë‹¤ìš´ë¡œë“œ ì†ë„
- Reels (15ì´ˆ): ì•½ 2-5ì´ˆ
- ì‚¬ì§„: ì•½ 1-2ì´ˆ
- ê¸´ ë¹„ë””ì˜¤ (60ì´ˆ): ì•½ 5-10ì´ˆ

ë„¤íŠ¸ì›Œí¬ ì†ë„ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
